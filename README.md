# AutoCAD 聚合線長度分析程式使用說明

## 功能概述
此程式提供聚合線分析功能：支援框選或點選多條聚合線進行即時分析，結果在彈窗顯示。

## 主要功能

### ?? 聚合線分析功能
- **框選支援**: 支援框選多條聚合線，提高選擇效率
- **點選支援**: 也支援傳統的逐一點選方式
- **多線分析**: 可同時分析多條聚合線
- **引線選擇**: 可選擇相關的引線標註和文字
- **即時結果**: 彈窗顯示詳細分段資訊
- **無需設定**: 簡單直接，一鍵分析
- **分段統計**: 每個彎折點分為一段，分別計算長度
- **弧線支援**: 支援直線段和弧線段的長度計算
- **引線文字擷取**: 自動擷取相關的引線文字

## 使用方法

### ?? 聚合線分析

#### 1. 啟動命令
在AutoCAD命令列輸入：
- `PLPICK` 或
- `聚合線點選`

#### 2. 操作步驟
1. **選擇聚合線**: 
   - **框選方式**: 拖拉框選範圍，一次選擇多條聚合線
   - **點選方式**: 逐一點選聚合線
   - **混合方式**: 可以先框選，再補點選
2. **選擇引線** (可選): 
   - 點選相關的引線標註或文字
   - 可選擇多個引線文字
   - 按 `Enter` 結束選擇或跳過
3. **查看結果**: 程式會彈窗顯示詳細分析結果

#### 3. 支援的引線類型
- Leader (引線)
- MLeader (多重引線)
- DBText (單行文字)
- MText (多行文字)

## 輸出格式

### ?? 分析結果
彈窗顯示內容包括：
- **引線標註文字**: 選擇的引線文字列表
- **線段分析**: 每段的詳細資訊
  - 段數序號
  - 長度（精確到小數點後2位）
- **總計資訊**: 總長度、總段數、聚合線數量

#### 範例彈窗內容=== 聚合線分段分析結果 ===

引線標註文字:
  ? 污水管線
  ? DN300

線段分析:
  第 1 段: 15.50 單位
  第 2 段: 12.30 單位
  第 3 段: 8.75 單位
  第 4 段: 20.15 單位

總長度: 56.70 單位
總段數: 4 段
聚合線數量: 2 條
## 注意事項

### ?? 分析注意事項
- **聚合線選擇**: 只能選擇聚合線物件
- **選擇方式**: 支援框選和點選，框選更高效
- **多線處理**: 可同時處理多條聚合線
- **引線距離**: 引線文字在引線終點5.0單位範圍內會被自動識別
- **彈窗資訊**: 結果僅在彈窗顯示，不會自動儲存

### ?? 分段規則
- 每個頂點（彎折點）之間為一段
- 支援直線段和弧線段的長度計算
- 弧線段會自動計算弧長
- 所有選中聚合線的線段會合併顯示

### ?? 選擇技巧
- **大範圍選擇**: 使用框選功能快速選擇多條聚合線
- **精確選擇**: 使用點選功能精確選擇特定聚合線
- **混合選擇**: 先框選大部分，再點選補充
- **過濾選擇**: 程式會自動過濾非聚合線物件

## 命令對照表

| 功能 | 英文命令 | 中文命令 | 說明 |
|------|----------|----------|------|
| 聚合線分析 | `PLPICK` | `聚合線點選` | 支援框選或點選多條聚合線進行分析 |

## 故障排除

### ?? 常見問題

#### 無法選擇聚合線
- 確認點選的是聚合線物件，非直線或其他圖形
- 檢查聚合線是否在模型空間中
- 使用框選時確保聚合線在選擇範圍內

#### 框選沒有選中聚合線
- 確認框選範圍包含聚合線
- 檢查圖層是否被鎖定或隱藏
- 確認聚合線物件類型正確

#### 引線文字無法識別
- 確認引線終點與文字距離在5.0單位以內
- 檢查文字是否為DBText或MText類型

#### 彈窗沒有顯示
- 檢查是否有錯誤訊息在命令列
- 確認至少選擇了一條有效的聚合線

## 技術規格

### 系統需求
- AutoCAD 2024或更新版本
- .NET 8.0 Runtime

### 使用的技術
- **.NET 8.0**: 框架版本
- **AutoCAD.NET 25.0.1**: AutoCAD API
- **SelectionFilter**: 自動過濾聚合線物件

## 版本更新記錄

### v4.0 (最新版本)
- ?? **框選支援**: 新增框選功能，支援快速選擇多條聚合線
- ?? **多線分析**: 支援同時分析多條聚合線
- ?? **簡化顯示**: 移除座標顯示，專注於長度資訊
- ?? **智能過濾**: 自動過濾非聚合線物件

### v3.0
- ?? **簡化功能**: 移除複雜的批量統計功能
- ?? **專注點選**: 專注於單條聚合線的即時分析
- ?? **改善體驗**: 更簡潔的操作流程
- ?? **減少相依性**: 移除外部套件相依性

### v2.0
- ?? **新增點選分析功能**: 直接點選聚合線進行分析
- ?? **多重引線支援**: 支援選擇多個引線標註
- ?? **即時結果顯示**: 彈窗顯示詳細分段資訊
- ?? **改善用戶體驗**: 簡化操作流程

### v1.2
- 改用CSV格式輸出，解決Excel套件相依性問題
- 提升程式穩定性和相容性
- 簡化部署，無需額外套件
- 支援UTF-8編碼，確保中文正確顯示

### v1.1
- 將Excel處理套件從ClosedXML更換為EPPlus
- 修正.NET 8環境下的相依性問題

### v1.0
- 初始版本
- 基本聚合線統計功能

## 優勢特色

### ?? **選擇方式優勢**
- **框選高效**: 一次性選擇多條聚合線
- **點選精確**: 精確選擇特定聚合線
- **混合靈活**: 框選+點選的混合使用方式
- **智能過濾**: 自動識別聚合線物件

### ?? **分析功能優勢**
- **多線處理**: 同時分析多條聚合線
- **即時反?**: 立即顯示分析結果
- **資訊簡潔**: 專注於長度和段數資訊
- **引線整合**: 支援引線標註文字

### ?? **技術優勢**
- **高穩定性**: 簡化架構，減少出錯機會
- **易於使用**: 直觀的選擇操作方式
- **功能專精**: 專注於核心分析功能
- **輕量化**: 程式碼精簡，執行效率高

## 技術支援
如有問題或建議，請聯繫開發團隊。

---
**使用方式**: 使用 `PLPICK` 或 `聚合線點選` 命令，支援框選或點選多條聚合線進行分析。